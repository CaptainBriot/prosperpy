import unittest
import decimal

import prosperpy


def get_prices():
    prices = ['52.78000', '53.02000', '53.67000', '53.67000', '53.73750', '53.45000', '53.71500', '53.38500',
              '52.51000', '52.31500', '51.45000', '51.60000', '52.43000', '52.47000', '52.91000', '52.07000',
              '53.12000', '52.77000', '52.73000', '52.08500', '53.19000', '53.73000', '53.87000', '53.84500',
              '53.88000', '54.08000', '54.13500', '54.49500', '54.30000', '54.39500', '54.16000']
    return [decimal.Decimal(price) for price in prices]


class TestStandardDeviation(unittest.TestCase):
    def test_standard_deviation(self):
        prices = get_prices()
        data = ['0.73012195043020045037707177471020258963108062744140625',
                '0.85736401983055021691626507163164205849170684814453125',
                '0.83364204698419575034762374343699775636196136474609375',
                '0.78870720961583706820618999699945561587810516357421875',
                '0.716250828969851927041645467397756874561309814453125',
                '0.675497779419000021761121388408355414867401123046875',
                '0.5846785441590960363811291244928725063800811767578125',
                '0.5078703082480802155629362459876574575901031494140625',
                '0.51835340261254192473217017322895117104053497314453125',
                '0.526061070599222357913049563649110496044158935546875',
                '0.480963875982386046548100466679898090660572052001953125',
                '0.49017573379350387607900074726785533130168914794921875',
                '0.5784394955395075754722711280919611454010009765625',
                '0.62290528975117875898348529517534188926219940185546875',
                '0.67009253092390153039303868354181759059429168701171875',
                '0.62202491911498203336350343306548893451690673828125',
                '0.661063726126309259001345708384178578853607177734375',
                '0.69035787820521032909226732954266481101512908935546875',
                '0.65115205597463943210101433578529395163059234619140625',
                '0.36046636458898628774250028072856366634368896484375',
                '0.24295884425144931295648120794794522225856781005859375']
        data = [decimal.Decimal(item) for item in data]

        std = prosperpy.indicators.StandardDeviation(prices[:10])
        self.assertEqual(std.period, 10)
        self.assertEqual(std.value, decimal.Decimal('0.50541128054288619875222821065108291804790496826171875'))

        for price, value in zip(prices[10:], data):
            self.assertEqual(std(price), value)
